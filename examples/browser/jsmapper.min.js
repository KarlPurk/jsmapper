var JsMapper={Mapper:{},Transport:{},Util:{}};JsMapper.Transport.Default=function(){"use strict";var a=function(){};return a.prototype.validateOptions=function(a){if(!a.url)throw{type:"XmlHttpRequestMapperTransportException",message:"You must provide a url"}},a.prototype.request=function(a){this.validateOptions(a),this.doRequest(a)},a.prototype.doRequest=function(){throw{type:"MapperTransportException",message:"You must overload the request method"}},a}(),JsMapper.Transport.JQuery=function(){"use strict";var a=JsMapper.Transport.Default,b=function(){};return b.prototype=Object.create(a.prototype),b.prototype.doRequest=function(a){jQuery.ajax(a)},b}(),JsMapper.Transport.XmlHttpRequest=function(){"use strict";var a=JsMapper.Transport.Default,b=function(){};return b.prototype=Object.create(a.prototype),b.prototype.createXmlHttpRequest=function(){var a=require("xmlhttprequest").XMLHttpRequest;return new a},b.prototype.doRequest=function(a){var b=this.createXmlHttpRequest();if(b.open(a.type||"GET",a.url),b.onreadystatechange=function(){this.readyState===this.DONE&&(200===this.status?"function"==typeof a.onSuccess&&a.onSuccess(this.response):"function"==typeof a.onFailure&&a.onFailure(this.responseText))},a.responseType&&(b.responseType=a.responseType),a.headers)for(var c in a.headers)a.headers.hasOwnProperty(c)&&b.setRequestHeader(c,a.headers[c]);b.send()},b}(),JsMapper.Util.PromiseArray=function(){"use strict";var a=function(){this.isLoaded=!1};return a.prototype=Object.create(Array.prototype),a}(),JsMapper.Mapper.Default=function(){"use strict";var a=function(){};return a.prototype.load=function(a,b){return b=b||this.createModel(),b=this.mapProperties(a,b)},a.prototype.mapProperties=function(a,b){for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},a.prototype.createCollection=function(){return[]},a.prototype.createModel=function(){throw{type:"MapperException",message:"You must provide a model by overloading createModel"}},a.prototype.loadMany=function(a,b){var c=this;return b=b||this.createCollection(),a.forEach(function(a){b.push(c.load(a))}),b},a}(),JsMapper.Mapper.Promise=function(){"use strict";var a=JsMapper.Mapper.Default,b=JsMapper.Util.PromiseArray,c=function(){};return c.prototype=Object.create(a.prototype),c.prototype.createPromiseModel=function(){var a=this.createModel();return a.isLoaded=!1,a},c.prototype.setTransport=function(a){this.transport=a},c.prototype.getTransport=function(){return this.transport||(this.transport=MapperTransport.createXmlHttpRequestTransport()),this.transport},c.prototype.fetchRequest=function(a,b,c){var d=this,e=a.onSuccess,f=a.onFailure;return a.onSuccess=function(a){var f=JSON.parse(a);c.isLoaded=!0,b.call(d,f,c),"function"==typeof e&&e(f)},a.onFailure=function(a){c.isLoaded=!0,"function"==typeof f&&f(a)},this.getTransport().request(a),c},c.prototype.fetch=function(a){return this.fetchRequest(a,this.load,this.createPromiseModel())},c.prototype.fetchMany=function(a){return this.fetchRequest(a,this.loadMany,new b)},c}();